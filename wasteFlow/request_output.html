<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WasteFlow — Waste Collection Request (Output)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style2.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="wf-body">
  <header class="wf-header">
    <div class="wf-title">WasteFlow — Waste Collection Request (Output)</div>
    <nav class="wf-nav">
      <a href="dashboard.html">Dashboard</a>
      <a href="request_input.html">Input</a>
    </nav>
  </header>

  <main class="wf-main">
    <section class="wf-section">
      <h2 class="wf-h2">Submitted Requests</h2>

      <!-- Filters -->
      <form class="wf-form compact" onsubmit="event.preventDefault();">
        <div class="wf-grid-4">
          <div class="wf-field">
            <label for="fType">Waste Type</label>
            <select id="fType">
              <option value="All">All</option>
              <option value="Organic">Organic</option>
              <option value="Plastic">Plastic</option>
              <option value="E-Waste">E-Waste</option>
              <option value="Medical">Medical</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="wf-field">
            <label for="fWard">Ward</label>
            <input id="fWard" type="number" min="1" max="100" placeholder="Ward No." />
          </div>
          <div class="wf-field">
            <label for="fService">Service Type</label>
            <select id="fService">
              <option value="All">All</option>
              <option value="Regular">Regular</option>
              <option value="Express">Express</option>
            </select>
          </div>
          <div class="wf-actions end">
            <button class="wf-btn ghost" onclick="resetFilters()">Reset</button>
          </div>
        </div>
      </form>

      <!-- Table -->
      <div class="table-scroll">
        <table class="wf-table" id="requestsTable">
          <thead>
            <tr>
              <th>Request ID</th>
              <th>User ID</th>
              <th>Ward</th>
              <th>Type</th>
              <th>Quantity (kg)</th>
              <th>Service</th>
              <th>Schedule</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>R1001</td><td>U1001</td><td>12</td><td>Organic</td><td>15</td><td>Regular</td><td>2025-08-20 10:00</td>
              <td>
                <button class="wf-btn small edit" onclick="openEdit(this)">Update</button>
                <button class="wf-btn small delete" onclick="deleteRequest(this)">Delete</button>
              </td>
            </tr>
            <tr>
              <td>R1002</td><td>U1002</td><td>10</td><td>Plastic</td><td>5</td><td>Express</td><td>2025-08-20 12:00</td>
              <td>
                <button class="wf-btn small edit" onclick="openEdit(this)">Update</button>
                <button class="wf-btn small delete" onclick="deleteRequest(this)">Delete</button>
              </td>
            </tr>
            <tr>
              <td>R1003</td><td>U1003</td><td>12</td><td>Organic</td><td>20</td><td>Regular</td><td>2025-08-21 09:00</td>
              <td>
                <button class="wf-btn small edit" onclick="openEdit(this)">Update</button>
                <button class="wf-btn small delete" onclick="deleteRequest(this)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="wf-section">
      <h3>Waste Type Distribution</h3>
      <canvas id="wasteChart" height="180"></canvas>
    </section>

    <section class="wf-section">
      <h3>Requests per Ward</h3>
      <canvas id="wardChart" height="180"></canvas>
    </section>
  </main>

  <footer class="wf-footer">© 2025 WasteFlow · Dhaka City</footer>

  <!-- Edit Modal -->
  <div id="editModal" class="wf-modal">
    <div class="wf-modal-content">
      <h3>Edit Request</h3>
      <form id="editForm" onsubmit="event.preventDefault()">
        <input type="hidden" id="editRowIndex" />

        <label>Ward</label>
        <input type="number" id="eWard" required />

        <label>Waste Type</label>
        <select id="eType">
          <option>Organic</option>
          <option>Plastic</option>
          <option>E-Waste</option>
          <option>Medical</option>
          <option>Others</option>
        </select>

        <label>Quantity (kg)</label>
        <input type="number" id="eQty" required />

        <label>Service Type</label>
        <select id="eService">
          <option>Regular</option>
          <option>Express</option>
        </select>

        <label>Schedule</label>
        <input type="datetime-local" id="eSchedule" required />

        <div class="wf-actions end">
          <button type="button" class="wf-btn ghost" onclick="closeEdit()">Cancel</button>
          <button type="submit" class="wf-btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const table = document.getElementById('requestsTable').getElementsByTagName('tbody')[0];
    let currentRow = null;

    // Filters
    function resetFilters() {
      document.getElementById('fType').value = 'All';
      document.getElementById('fWard').value = '';
      document.getElementById('fService').value = 'All';
      applyFilters();
    }

    function applyFilters() {
      const typeVal = document.getElementById('fType').value.toLowerCase();
      const wardVal = document.getElementById('fWard').value.trim();
      const serviceVal = document.getElementById('fService').value.toLowerCase();

      Array.from(table.rows).forEach(r => {
        const type = r.cells[3].innerText.toLowerCase();
        const ward = r.cells[2].innerText.trim();
        const service = r.cells[5].innerText.toLowerCase();
        const okType = (typeVal === 'all') || type.includes(typeVal);
        const okWard = (!wardVal) || ward === wardVal;
        const okService = (serviceVal === 'all') || service.includes(serviceVal);
        r.style.display = (okType && okWard && okService) ? '' : 'none';
      });
    }

    [document.getElementById('fType'),
     document.getElementById('fWard'),
     document.getElementById('fService')].forEach(el => el.addEventListener('input', applyFilters));

    // Edit functions
    function openEdit(btn) {
      currentRow = btn.closest('tr');
      document.getElementById('eWard').value = currentRow.cells[2].innerText;
      document.getElementById('eType').value = currentRow.cells[3].innerText;
      document.getElementById('eQty').value = currentRow.cells[4].innerText;
      document.getElementById('eService').value = currentRow.cells[5].innerText;
      document.getElementById('eSchedule').value = currentRow.cells[6].innerText.replace(" ", "T");
      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEdit() {
      document.getElementById('editModal').style.display = 'none';
    }

    document.getElementById('editForm').addEventListener('submit', function(e) {
      e.preventDefault();
      currentRow.cells[2].innerText = document.getElementById('eWard').value;
      currentRow.cells[3].innerText = document.getElementById('eType').value;
      currentRow.cells[4].innerText = document.getElementById('eQty').value;
      currentRow.cells[5].innerText = document.getElementById('eService').value;
      currentRow.cells[6].innerText = document.getElementById('eSchedule').value.replace("T"," ");
      closeEdit();
    });

    function deleteRequest(btn) {
      if(confirm("Are you sure you want to delete this request?")) {
        btn.closest("tr").remove();
      }
    }

    // Charts
    new Chart(document.getElementById('wasteChart'), {
      type: 'pie',
      data: {
        labels: ['Organic','Plastic','E-Waste','Medical','Others'],
        datasets: [{ data: [35,20,5,8,10], backgroundColor: ['#28a745','#ffc107','#dc3545','#6c757d','#17a2b8'] }]
      }
    });

    new Chart(document.getElementById('wardChart'), {
      type: 'bar',
      data: {
        labels: ['Ward 9','Ward 10','Ward 12','Ward 15'],
        datasets: [{ label: 'Requests', data: [12,8,15,5], backgroundColor: '#007bff' }]
      },
      options: { plugins: { legend: { display: false } } }
    });
  </script>
</body>
</html>
